#!/bin/bash -eux
#
#MSUB -N vpic-baseline
#MSUB -l walltime=0:40:00
#MSUB -l nodes=1:haswell
#MSUB -o /users/$USER/joblogs/vpic-baseline-$MOAB_JOBID.out
#MSUB -j oe
#DW jobdw access_mode=striped capacity=25GiB type=scratch
ip_subnet="11.128"
ppn=32 ## aprun -N 32
export JOBDIRHOME="/lustre/ttscratch1/users/$USER"
export EXTRA_MPIOPTS="--cc cpu"  ## only applies to main vpic calls
#|
#|  VPIC baseline | Run 1 | Run 2 | Run 3 | Run 4 |#########################
#|---------------:|:-----:|:-----:|:-----:|:-----:|#########################
#|          nodes |   1   |   4   |   16  |   64  |#########################
#| num_vpic_dumps |   8   |   8   |   8   |   8   |#########################
#|      px_factor |   16  |   16  |   16  |   16  |#########################
#|      py_factor |   4   |   4   |   4   |   4   |#########################
#|            ppn |   32  |   32  |   32  |   32  |#########################
#|
#|--------------
#| RUN CONF
#|----------
nodes=1  ## aprun -n $(( nodes * ppn )) -N $ppn ...
num_vpic_dumps=2  ## see table above
px_factor=4  ## see table above
py_factor=2  ## see table above
##DOIT
@CMAKE_INSTALL_PREFIX@/scripts/run_vpic_baseline.sh \
    $ip_subnet \
    $nodes \
    $ppn \
    $ppn \
    $ppn \
    $num_vpic_dumps \
    $px_factor \
    $py_factor

exit 0
